generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  
}



model User {
  id            String    @id @default(cuid())
  clerkId       String    @unique
  email         String    @unique

  firstName     String?
  lastName      String?
  address       String?
  businessName  String?
  profileImage  String?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  invoices      Invoice[]
  assets        Asset[]
  chatSessions  ChatSession[]
  
  onboardingCompleted Boolean @default(false)
  
  defaultCurrency String @default("USD")
  defaultTaxRate  Float @default(0)
  defaultNotes    String?

  @@index([clerkId])
}

enum InvoiceStatus {
  PENDING
  PAID
  VOID
  DRAFT
}

model Invoice {
  id            String   @id @default(uuid())
  invoiceNumber String
  date          DateTime
  dueDate       DateTime
  currency      String

  fromName      String
  fromEmail     String
  fromAddress   String

  toName        String
  toEmail       String
  toAddress     String
  total         Float 

  items         Json
  taxRate       Float
  taxName       String   @default("Tax")
  discount      Float    @default(0)
  notes         String?

  template      String   @default("clean")
  color         String   @default("#000000")

  status        InvoiceStatus @default(PENDING)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  companyLogo   String?  @db.Text
  signature     String?  @db.Text

  @@index([userId])
}

enum AssetType {
  LOGO
  SIGNATURE
  PROFILE_PHOTO
}

model Asset {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      AssetType
  name      String
  mimeType  String
  base64    String   @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model ChatSession {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title     String   @default("New Chat")
  
  messages  ChatMessage[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
}

model ChatMessage {
  id        String   @id @default(cuid())
  sessionId String
  session   ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  
  role      String   // "user" | "assistant"
  content   String   @db.Text
  
  createdAt DateTime @default(now())
  
  @@index([sessionId])
}
